% latexmk -pdflatex='pdflatex %O %S' -pvc -pdf modal_descent.tex
\documentclass[9pt,twosided]{amsart}

\usepackage{hott}

\usepackage{phonetic} % for esh

\newcommand{\shape}{\ensuremath{\mathord{\raisebox{0.5pt}{\text{\rm\esh}}}}}
\newcommand{\drawpb}[1]{\arrow[#1, phantom, "\text{\scriptsize(pb)}" description]}
\newcommand{\bC}{\mathbb C}
\newcommand{\bD}{\mathbb D}
\newcommand{\bN}{\mathbb N}
\newcommand{\bR}{\mathbb R}
\newcommand{\bZ}{\mathbb Z}
\newcommand{\bP}{\mathbb P}
\newcommand{\bA}{\mathbb A}
\newcommand{\bS}{\mathbb S}
\newcommand{\Zar}{\ensuremath{\mathrm{Zar}}}
\newcommand{\FSGrpOne}{\ensuremath{\mathsf{FSGrp}_1}}
\newcommand{\FSGrp}{\ensuremath{\mathsf{FSGrp}}}
\newcommand{\Spaces}{\ensuremath{\mathrm{Etop}\infty\mathrm{Gpd}}}
\newcommand{\todo}[1]{{\color{red}#1}}
\newcommand{\ignore}[1]{}

\addbibresource{literatur.bib}

\title{Modal descent}
\author{Felix Cherubini and Egbert Rijke}
\date{\today}

\begin{document}

\maketitle

\begin{abstract}
  We show that there is a second orthogonal factorization system associated to any modality, of which the left class is the class of $\modal$-equivalences and the right class is the class of $\modal$-\'etale maps. In the special case of the $n$-truncation, we characterize the $n$-\'etale maps as the maps that are right orthogonal to the map $\unit \to \sphere{n+1}$. We prove a `modal flattening lemma' and a `modal descent theorem'. The latter asserts that a $\modal$-\'etale map into a type $X$ is the same thing as a family of modal types over $\modal X$. Furthermore we describe a wide range of applications building on the conjectured interpretation of Homotopy Type Theory in certain $(\infty,1)$-sheaf-toposes. We discuss conjectural applications, where $\modal$-étale maps contain formally étale maps from Algebraic Geometry, local diffeomorphisms between manifolds or projections from covering spaces in Topology. The latter also suggests a theory of covering spaces for topological stacks.
\end{abstract}

\section{Introduction}
In 2011 Urs Schreiber and Mike Shulman introduced Modalities to Homotopy Type Theory,
with the idea to use these extended theories to reason about more specialized $(\infty,1)$-toposes.
One special application they had in mind was to use Homotopy Type Theory to talk about \emph{cohesive} $(\infty,1)$-toposes,
which is witnessed in the notes \cite{ShulmanSchreiber}.
This idea of a cohesive type theory was later developed in \cite{ShulmanRealCohesion} for a special case.
While the applications of the theory in this article are at least close to these ideas,
we will work with a simpler setup of only one \emph{monadic} modality, given in the most straightforward way -- as a list of axioms.
And for most of the article we will only apply our theory to the commonly known truncation modalities.
  
Modalities are defined in \cite[Section 7.7]{UFP} and were studied extensively in \cite{RijkeSpittersShulman}.
There are two factorization systems associated to a modality which coincide in the case of a left exact modality,
we will study one of these factorization systems, the other one has been studied in \cite{RijkeSpittersShulman}.
The factorization system studied in this article was already used in Category Theory, in \cite{cassidy_hebert_kelly_1985}, where the reflector of a reflective subcategory takes the role of the modality.
The left maps are the maps that are inverted by the modality and the right maps are those with a cartesian naturality square.
The name of maps in the right class is inspired by algebraic geometry -- they are called $\modal$-étale,
where $\modal$ is the modality.

In \cref{thm:char_n_etale} we use our abstract theory to prove the following characterization of étale maps for the $n$-truncations ($n\geq -1$): \\
A map $f:A\to B$ is $n$-\'etale if and only if it is right orthogonal to $\unit\to\sphere{n+1}$.

The application in \cref{subsection:toplogical stacks} suggests a new notion of covering space for topological stacks and shows that
one interpretation of the modal descent theorem (\cref{thm:modal_descent}) is an extension of the classical fundamental theorem of the theory of covering spaces,
relating covering spaces over a fixed space with certain actions of its fundamental groupoid.
A version of modal descent for the fundamental infinity groupoid functor of a cohesive $(\infty,1)$-topos was proven by Urs Schreiber as \cite[Proposition 5.2.42]{SchreiberDcct}.
The usual covering theory is recovered by restricting to maps between 0-types and setting the homotopy level to 1,
since it is concerned with the 1-truncated homotopy type of a topological space.
This expands on an idea of the first author from \cite{wellen-oxford-abstract}.
We also give characterizations and descriptions of formally étale maps in the sense of Algebraic Geometry.
  
We thank Jonas Frey and Mike Shulman for help in understanding factorization systems in a long email discussion in early 2018.
Discussions with and remarks of Marcelo Fiore, Steve Awodey, Eric Finster, André Joyal and Mathieu Anel were helpful for this work.
The anonymous reviewers greatly improved the article with their comments and suggestions. 
We gratefully acknowledge the support of the Air Force Office of Scientific Research through MURI grant FA9550-15-1-0053.
Any opinions, findings and conclusions or recommendations expressed in this material are those of the authors and do not necessarily reflect the views of the AFOSR.


\section{Preliminaries}
We assume the reader is familiar with the basics of homotopy type theory. To the reader who is not familiar with HoTT we recommend \cite{UFP}.

We make extensive use of homotopy pullbacks. The most important property we will be relying on is the following theorem:

\begin{thm}
  Consider a commuting square
  \begin{equation*}
    \begin{tikzcd}
      A \arrow[r,"h"] \arrow[d,swap,"f"] & X \arrow[d,"g"] \\
      B \arrow[r,swap,"i"] & Y
    \end{tikzcd}
  \end{equation*}
  with homotopy $H:i\circ f\htpy g\circ h$. Then the following are equivalent:
  \begin{enumerate}
  \item The square is a pullback square.
  \item For each $b:B$ the induced map on fibers
    \begin{equation*}
      \fib{f}{b} \to \fib{g}{i(b)}
    \end{equation*}
    is an equivalence.
  \end{enumerate}
\end{thm}

For an arbitrary commuting square, the induced map into the pullback is called the \define{gap map}. One can show that the fibers of the gap map are equivalent to the fibers of the induced maps on fibers. This observation implies the above theorem.

The main object of study in this article is a modality, of which the primary examples are the $n$-truncations. There are many equivalent ways of saying what a modality is \cite{RijkeSpittersShulman}. The most convenient definition for our purpose is that of a \emph{stable orthogonal factorization system}, which we recall now.

\begin{defn}
  An orthogonal factorization system is a pair $(\mathcal{L},\mathcal{R})$ of classes of maps
  \begin{align*}
    \mathcal{L} & : \prd{X,Y:\UU} (X \to Y) \to \mathsf{Prop} \\
    \mathcal{R} & : \prd{X,Y:\UU} (X \to Y) \to \mathsf{Prop} 
  \end{align*}
  such that
  \begin{enumerate}
  \item Both $\mathcal{L}$ and $\mathcal{R}$ contain all equivalences and are closed under composition.
  \item Every map $f:X\to Y$ factors as a left map (i.e.~a map in $\mathcal{L}$) followed by a right map (i.e.~a map in $\mathcal{R}$). More precisely, for every map $f:X\to Y$ there is a type $\mathsf{im}_{(\mathcal{L},\mathcal{R})}(f)$ equipped with maps $f_{\mathcal{L}}:X\to \mathsf{im}_{(\mathcal{L},\mathcal{R})}(f)$, $f_{\mathcal{R}}:\mathsf{im}_{(\mathcal{L},\mathcal{R})}(f) \to Y$ and a homotopy witnessing that the triangle
    \begin{equation*}
      \begin{tikzcd}
        X \arrow[rr,"f"] \arrow[dr,swap,"f_{\mathcal{L}}"] & & Y \\
        & \mathsf{im}_{(\mathcal{L},\mathcal{R})}(f) \arrow[ur,swap,"f_{\mathcal{R}}"]
      \end{tikzcd}
    \end{equation*}
    commutes.
  \item Every map in the left class is \define{left orthogonal} to every map in the right class (we also say that every map in $\mathcal{R}$ is right orthogonal to every map in $\mathcal{L}$). Following the observations of \cite{AnelBiedermanFinsterJoyal}, this means that for any map $i:A \to B$ in $\mathcal{L}$ and any map $f:X \to Y$ in $\mathcal{R}$, the square
    \begin{equation*}
      \begin{tikzcd}
        X^B \arrow[r] \arrow[d] & Y^B \arrow[d] \\
        X^A \arrow[r] & Y^A
      \end{tikzcd}
    \end{equation*}
    is a pullback square.
  \end{enumerate}
  An orthogonal factorization system is said to be \define{stable} if the left class is stable under pullbacks. That is, for any pullback square
    \begin{equation*}
      \begin{tikzcd}
        A \arrow[r,"h"] \arrow[d,swap,"f"] & X \arrow[d,"g"] \\
        B \arrow[r,swap,"i"] & Y
      \end{tikzcd}
    \end{equation*}
    in which the map $g:X \to Y$ is in $\mathcal{L}$, it is required that $f$ is also in $\mathcal{L}$. A \define{modality} is defined to be a stable orthogonal factorization system.
\end{defn}

Given a stable orthogonal factorization system, we say that a type $X$ is modal if the terminal projection $X\to \unit$ is in $\mathcal{R}$. 
There is an operation $\modal:\UU\to\UU$ associated to any stable orthogonal factorization, which is often called the modality. It is defined as
\begin{equation*}
\modal X \defeq \mathsf{im}_{(\mathcal{L},\mathcal{R})}(X\to \unit).
\end{equation*}
The left factor $X \to \modal X$ of this factorization is called the \define{modal unit} and is denoted by $\eta:X\to \modal X$. One can show that for any family $P:\modal X \to \UU$ of modal types, the pre-composition map
\begin{equation*}
\blank\circ \eta : \Big(\prd{x:\modal X}P(x)\Big)\to \Big(\prd{x:X}P(\eta(x))\Big)
\end{equation*}
is an equivalence. This property is called the \define{unique elimination principle} for modalities, and modalities can be defined equivalently in terms of the unique elimination principle.

We recall that for any two modalities $(\mathcal{L},\mathcal{R})$ and $(\mathcal{L}',\mathcal{R}')$ the following are equivalent:
\begin{enumerate}
\item Every $(\mathcal{L},\mathcal{R})$-modal type is $(\mathcal{L}',\mathcal{R}')$-modal.
\item The modal units of the modality $(\mathcal{L}',\mathcal{R}')$ are in $\mathcal{L}$.
\end{enumerate}
In particular: for any modality it follows that every proposition is modal if and only if the modal units are surjective.

\section{\texorpdfstring{$\modal$}{○}-\'etale maps}

\begin{defn}
We say that a map $f:A\to B$ is \define{$\modal$-\'etale}, if the square
\begin{equation*}
\begin{tikzcd}
A \arrow[r,"f"] \arrow[d,swap,"\eta"] & B \arrow[d,"\eta"] \\
\modal A \arrow[r,swap,"\modal f"] & \modal B
\end{tikzcd}
\end{equation*}
is a pullback square. We will write $\isetale(f)$ for this proposition.
\end{defn}

Using that $\modal$ preserves equivalences and composition up to homotopy,
it is immediate from the definition that any equivalence is $\modal$-\'etale, and that the $\modal$-\'etale maps are closed under composition.

\begin{eg}\label{eg:etale_prop}
We claim that a map $f:A\to B$ is $\brck{\blank}$-\'etale if and only if $A\to \isequiv(f)$. Examples of maps that satisfy this condition include equivalences, maps between propositions, and any map of the form $\emptyt\to B$.

To see that if $f:A\to B$ is $\modal$-\'etale, then $A\to\isequiv(f)$, consider the pullback square
\begin{equation*}
\begin{tikzcd}
A \arrow[r] \arrow[d,swap,"f"] & \brck{A} \arrow[d,"\brck{f}"] \\
B \arrow[r] & \brck{B},
\end{tikzcd}
\end{equation*}
and let $a:A$. Then both $\brck{A}$ and $\brck{B}$ are contractible, so $\brck{f}:\brck{A}\to\brck{B}$ is an equivalence. Since equivalences are stable under pullback it follows that $f$ is an equivalence.

Now suppose that $A\to \isequiv(f)$. Since $\isequiv(f)$ is a proposition, we also have $\brck{A}\to\isequiv(f)$. To see that the gap map
\begin{equation*}
A \to B\times_{\brck{B}}\brck{A}
\end{equation*}
is an equivalence, we will show that its fibers are contractible. Let $b:B$, $x:\brck{A}$ and $p:\bproj{b}=\brck{f}(x)$. Since $\brck{A}\to\isequiv(f)$, it follows that $f$ is an equivalence. Then $\brck{f}$ is also an equivalence, from which it follows that the naturality square is a pullback square. We conclude that the fibers of the gap map are contractible. 
\end{eg}

\begin{lem}\label{lem:etale_modal}
Any map between $\modal$-modal types is $\modal$-\'etale.
\end{lem}

\begin{proof}
Suppose $f:X\to Y$ is a map between $\modal$-modal types. Then the top and bottom maps in the square
\begin{equation*}
\begin{tikzcd}
X \arrow[r] \arrow[d] & \modal X \arrow[d] \\
Y \arrow[r] & \modal Y
\end{tikzcd}
\end{equation*}
are equivalences. Therefore this square is a pullback square, so $f$ is $\modal$-\'etale.
\end{proof}

In this section our goal is an almost general charachterization of $\modal$-étale maps and using it to characterize the $\modal$-\'etale maps for the $n$-truncations. We call such maps \define{$n$-\'etale}. Note that the case of propositional truncation has already been addressed in \cref{eg:etale_prop}.
The characterization only works if the domain of the map in question has a surjective $\modalunit$.
\begin{defn}
  A map $\varphi:X\to Y$ is surjective, if all its fibers are merely inhabited.
\end{defn}
Note that using the connected-truncated factorization system from \cite{RijkeSpittersShulman}, we can see that all $\modalunit$ are surjective for some modality, if and only if all propositions are modal.
So in case of $\trunc{n}{\_}$ with $n\geq -1$, the characterization always works.

We recall from \cite{wellen-thesis} the notion of formal disk associated to a modality and give it a more generic name.

\begin{defn}
  Let $\modal$ be a modality, and let $a:A$. The $\modal$-disk $D^{\modal}(A,a)$ of $A$ at $a$ is defined by
  \begin{equation*}
    D^\modal(A,a)\defeq \sm{x:A}\eta(a)=\eta(x).
  \end{equation*}
  In other words, the $\modal$-disk $D^\modal(A,a)$ is the fiber of $\eta:A\to\modal A$ at $\eta(a)$. In the special case where $\modal$ is the $n$-truncation, we write $D^n(A,a)$ for the $\trunc{n}{\_}$-disk at $a$ and if the modality is clear from the context, we allow ourselves to drop ``$\modal$'' from the notation and write just $D(A,a)$.
\end{defn}

There is always a map $\proj 1:D^\modal(A,a)\to A$.

The following lemma characterizes $\modal$-étale maps $f:A\to B$ for $A$ with surjective $\eta_A$.
The characterization (ii) can be informally described as: ``A $\modal$-étale map $f:A\to B$ is a trivial fibration over any $\modal$-disk  in $B$'',
while (i) can be stated as: ``A $\modal$-étale map $f:A\to B$ is $\modal$-étale if and only if it induces an equivalence on $\modal$-disks $D^\modal(A,x)$ for all $x:A$''. 

\begin{lem}\label{lem:etale_char}
  Let $\modal$ be a modality and $f:A\to B$ any map.
  If $f$ is $\modal$-\'etale, then (i) and (ii) below hold.
  If $\eta_A$ is surjective, then (i) and (ii) are equivalent and imply that f is $\modal$-étale.
\begin{enumerate}
\item The commuting square
\begin{equation*}
\begin{tikzcd}[column sep=large]
\sm{x:A}D^\modal(A,x) \arrow[d,swap,"\proj 1"] \arrow[r,"{f\times_{\modal f} f}"] & \sm{y:B}D^\modal(B,y) \arrow[d,"\proj 1"] \\
A \arrow[r,swap,"f"] & B
\end{tikzcd}
\end{equation*}
is a pullback square.
\item For all $x:A$ and $y:\equiv f(x)$ there is a map $\varphi_x:\modal(f)^{-1}(\eta(y))\times D(B,y)\to A$ such that
  \begin{equation*}
    \begin{tikzcd}[column sep=large]
      \modal(f)^{-1}(\eta(y))\arrow[r,"\varphi_x"]\arrow[d,swap,"\proj 2"]\times D(B,y)   &  A\arrow[d,"f"] \\
      D(B,y)\arrow[r,"\proj 1",swap]  & B
    \end{tikzcd}
  \end{equation*}
is a pullback square.
\end{enumerate}
\end{lem}

\begin{proof}
Let $f:A\to B$ be any map, $x:A$ and $y:\equiv f(x)$ then there is a commuting cube (where $\eta_A^\ast$ denotes the pullback along $\eta_A$):
\begin{equation*}
  \begin{tikzcd}
    &[-1ex] \eta_A^\ast\left((\modal f)^{-1}(\eta(y))\right)\arrow[dr,dashed]\arrow[dl,"\pi",swap]\arrow[d] &                         \\
(\modal f)^{-1}(\eta(y))\arrow[d] & A\arrow[dr, "f" near start]\arrow[dl, "\eta_A" near start, swap]     & D(B,y)\arrow[d,"\proj 1"]\arrow[dl, crossing over]   \\
 \modal A\arrow[dr, "\modal f",swap]  & 1\arrow[d ,"\eta(y)"]\arrow[from=ul, crossing over] & B\arrow[dl,"\eta_B"] \\
          & \modal B &
  \end{tikzcd}
\end{equation*}
The front squares and the back left square are pullbacks by definition. The back right square is a pullback by pullback-pasting. So all vertical squares are pullbacks.
If $f:A\to B$ is $\modal$-étale, the bottom square is a pullback and therefore, by pullback-pasting the top square is a pullback. This shows that (ii) holds if $f$ is $\modal$-étale, since in this case the top element is canonically identified with the product from (ii) which turns the back right square into the pullback square from (ii).

We will show now, that (ii) implies (i).
It is enough to show, that the induced maps
\[ D^\modal(A,x)\to D^\modal(B,y) \]
are equivalences for all $x:A$ and $y:\equiv f(x)$.

We paste a fiber square to the back left square of the cube:
\begin{equation*}
  \begin{tikzcd}
      \pi^{-1}(\eta(x))\arrow[r]\arrow[d] & \eta_A^\ast(\modal f)^{-1}(\eta(y))\arrow[r]\arrow[d, "\pi"] & A\arrow[d] \\
      1\arrow[rr,bend right=20,"\eta(x)",swap]\arrow[r,dashed]  & (\modal f)^{-1}(\eta(y))\arrow[r] & \modal A
  \end{tikzcd}
\end{equation*}
So the fiber $\pi^{-1}(\eta(x))$ is $D^\modal(A,x)$ by pullback pasting.
We assume (ii), so the top square in the cube above is a pullback.
Now we paste the left square to the top square:
\begin{equation*}
  \begin{tikzcd}
      D^\modal(A,x)\arrow[d]\arrow[r] & \eta_A^\ast(\modal f)^{-1}(\eta(y))\arrow[r]\arrow[d, "\pi"] & D^\modal(B,y)\arrow[d] \\
      1\arrow[r]                                & (\modal f)^{-1}(\eta(y))\arrow[r] & 1 
  \end{tikzcd}
\end{equation*}
The result is a pullback square witnessing that the induced map in question is an equivalence.

  Suppose that (ii) holds and that $\modalunit_A$ is surjective. So the induced map
\begin{equation*}
D^\modal(A,x)\to D^\modal(B,f(x))
\end{equation*}
is an equivalence for every $x:A$. Since $\modalunit_A$ is assumed to be surjective, there merely is an $x:A$ such that $\modalunit(x)=t$ for arbitrary $t:\modal A$.
It follows that
\begin{equation*}
\fib{\modalunit}{t}\to \fib{\modalunit}{\modal f(t)}
\end{equation*}
is an equivalence for every $t:\modal A$. Thus it follows that the square
\begin{equation*}
\begin{tikzcd}
A \arrow[d,swap,"\modalunit"] \arrow[r] & B \arrow[d,"\modalunit"] \\
\modal A \arrow[r] & \modal B
\end{tikzcd}
\end{equation*}
is a pullback square, showing that $f$ is $\modal$-étale.
\end{proof}

\begin{comment}%I don't think we need this
\begin{cor}
If $f:A\to B$ is $\modal$-\'etale, then the square
\begin{equation*}
\begin{tikzcd}[column sep=large]
A \arrow[d,swap,"\delta_{\modalunit}"] \arrow[r,"f"] & B \arrow[d,"\delta_{\modalunit}"] \\
A\times_{\modal A} A \arrow[r,swap,"f\times_{\modal f}f"] & B\times_{\modal B} B
\end{tikzcd}
\end{equation*}
is a pullback square.
\end{cor}

\begin{proof}
Consider the diagram
\begin{equation*}
\begin{tikzcd}[column sep=large]
A \arrow[d,swap,"\delta_{\modalunit}"] \arrow[r,"f"] & B \arrow[d,"\delta_{\modalunit}"] \\
A\times_{\modal A} A \arrow[d,swap,"\proj 1"] \arrow[r,"{f\times_{\modal f} f}"] & B\times_{\modal B} B \arrow[d,"\proj 1"] \\
A \arrow[r,"f"] & B
\end{tikzcd}
\end{equation*}
The bottom square is a pullback square by \cref{lem:etale_char}, and the outer rectangle is a pullback since both vertical composites are homotopic to the respective identity functions. Therefore the top square is a pullback.
\end{proof}
\end{comment}

\begin{rmk}\label{rmk:-1etale}
In the special case of $(-1)$-truncation, the characterization of \cref{lem:etale_char} (i) asserts that a map $f:A\to B$ is $(-1)$-\'etale if and only if the square
\begin{equation*}
\begin{tikzcd}
A\times A \arrow[d,swap,"\proj 1"] \arrow[r,"{f\times f}"] & B\times B \arrow[d,"\proj 1"] \\
A \arrow[r,swap,"f"] & B
\end{tikzcd}
\end{equation*}
is a pullback square. Phrased differently, we see that a map is $(-1)$-\'etale if and only if the square
\begin{equation*}
\begin{tikzcd}
A^{\sphere{0}} \arrow[d,swap,"\mathsf{ev}_\ast"] \arrow[r,"f^{\sphere{0}}"] & B^{\sphere{0}} \arrow[d,"\mathsf{ev}_\ast"] \\
A \arrow[r,swap,"f"] & B
\end{tikzcd}
\end{equation*}
is a pullback square.
\end{rmk}

\begin{rmk}
A map $f:A\to B$ is $0$-\'etale if and only if for each $a:A$ the restriction
\begin{equation*}
\begin{tikzcd}
\sm{x:A}\brck{a=x} \arrow[d,swap,"\proj 1"] \arrow[r,densely dotted,"f"] & \sm{y:B}\brck{f(a)=y} \arrow[d,"\proj 1"] \\
A \arrow[r,swap,"f"] & B
\end{tikzcd}
\end{equation*}
of $f$ to the connected component at $a$ of $A$ is an equivalence.

By \cref{lem:etale_char} and the fact that $\eqv{(\tproj{0}{a}=\tproj{0}{x})}{\brck{a=x}}$, it follows that $f$ is $0$-\'etale if and only if the square
\begin{equation*}
\begin{tikzcd}[column sep=huge]
\sm{a,x:A}\brck{a=x} \arrow[d,swap,"\proj 1"] \arrow[r,"\total{\brck{\apfunc{f}}}"] & \sm{b,y:B}\brck{b=y} \arrow[d,"\proj 1"] \\
A \arrow[r,swap,"f"] & B
\end{tikzcd}
\end{equation*}
is a pullback square. Furhtermore, this square is a pullback if and only if the induced map
\begin{equation*}
\Big(\sm{x:A}\brck{a=x}\Big)\to\Big(\sm{y:B}\brck{f(a)=y}\Big)
\end{equation*}
is an equivalence, for each $a:A$.

We note that a map $f:A\to B$ between pointed connected types is an equivalence if and only if it is an embedding, which happens if and only if $f^{\sphere{1}}:A^{\sphere{1}} \to B^{\sphere{1}}$ is an equivalence. We can use this fact to conclude that a map is $0$-connected if and only if the square
    \begin{equation*}
      \begin{tikzcd}
        A^{\sphere{1}} \arrow[r] \arrow[d] & B^{\sphere{1}} \arrow[d] \\
        A \arrow[r] & B
      \end{tikzcd}
    \end{equation*}
\end{rmk}

These remarks suggest the following theorem.

\begin{thm}
  \label{thm:char_n_etale}
  For any map $f:A\to B$ and any $n\geq -1$, the following are equivalent:
  \begin{enumerate}
  \item The map $f$ is $n$-\'etale.
  \item The map $f$ is right orthogonal to $\unit\to\sphere{n+1}$.
  \end{enumerate}
\end{thm}

\begin{rmk}
  For $n\jdeq -2$ the statement does not make sense, since there is no evaluation map
  $A^{\sphere{-1}}\to A$. On the other hand, it is easy to see that a map is $-2$-\'etale if and only if it is an equivalence.
\end{rmk}


\begin{proof}
  The case of $n\jdeq -1$ is already covered in \cref{rmk:-1etale}, so we assume that $n$ is at least $0$. Furthermore, recall that $f$ is right orthogonal to $\unit\to\sphere{n+1}$ if and only if the commuting square
    \begin{equation}\label{eq:orth}
      \begin{tikzcd}
        A^{\sphere{n+1}} \arrow[r] \arrow[d] & B^{\sphere{n+1}} \arrow[d] \\
        A \arrow[r] & B
      \end{tikzcd}
    \end{equation}
    is a pullback square.

  For the forward direction, suppose $f:A\to B$ is $n$-\'etale, and consider the commuting cube
\begin{equation*}
\begin{tikzcd}
&[-1ex] A^{\sphere{n+1}} \arrow[dl] \arrow[d] \arrow[dr] &[2ex] \\
\trunc{n}{A}^{\sphere{n+1}} \arrow[d] & B^{\sphere{n+1}} \arrow[dl] \arrow[dr] & A \arrow[dl,crossing over] \arrow[d] \\
\trunc{n}{B}^{\sphere{n+1}} \arrow[dr] & \trunc{n}{A} \arrow[d] \arrow[from=ul,crossing over] & B \arrow[dl] \\
& \trunc{n}{B}
\end{tikzcd}
\end{equation*}
In this cube the front right square is a pullback square by the assumption that $f$ is $n$-\'etale. The back left square is an exponent of this pullback square, so it is again pullback. The front left square is a pullback square because its top and bottom map are both equivalences. Therefore we conclude that the back right square is a pullback square, which shows that $f$ is right orthogonal to the map $\unit\to\sphere{n+1}$.

  For the converse, suppose that the square in \cref{eq:orth} is a pullback square. It follows that the (equivalent) square
  \begin{equation*}
    \begin{tikzcd}
      \sm{x:A}\mathsf{Map}_\ast(\sphere{n},\loopspace{A,x}) \arrow[r] \arrow[d] & \sm{y:B} \mathsf{Map}_\ast(\sphere{n},\loopspace{B,y}) \arrow[d] \\
      A \arrow[r] & B
    \end{tikzcd}
  \end{equation*}
is a pullback square.
  Since a square is a pullback square if and only if the top map is a fiberwise equivalence, it follows that the map
  \begin{equation*}
    \mathsf{Map}_\ast(\sphere{n},\loopspace{f,x}):\mathsf{Map}_\ast(\sphere{n},\loopspace{A,x}) \to \mathsf{Map}_\ast(\sphere{n},\loopspace{B,f(x)})
  \end{equation*}
  of pointed mapping spaces is an equivalence. To show that $f$ is $n$-\'etale, it is equivalent to show that the square
  \begin{equation*}
    \begin{tikzcd}
      A\times_{\trunc{n}{A}} A \arrow[r] \arrow[d] & B \times_{\trunc{n}{B}} B \arrow[d] \\
      A \arrow[r] & B
    \end{tikzcd}
  \end{equation*}
  is a pullback square, which is equivalent to showing that the induced map
  \begin{equation*}
    D^{n}(f,x):D^{n}(A,x)\to D^{n}(B,f(x))
  \end{equation*}
  on $\modal$-disks is an equivalence for each $x:A$. We note that the $\modal$-disks are the fibers of the unit $\eta:A \to \trunc{n}{A}$, so they are $n$-connected. It follows immediately that the map $D^{n}(f,x)$ is $(n-1)$-connected. Therefore it suffices to show that $D^{n}(f,x)$ is an $(n-1)$-truncated map.

  Recall that a map $\varphi$ between ($0$-)connected types is $(n-1)$-truncated if and only if $\varphi^{\sphere{n+1}}$ is an equivalence. Using our assumption that $n\geq 0$ we know that the $\modal$-disks under consideration are at least connected. Therefore it suffices to show that $(D^{n}(f,x))^{\sphere{n+1}}$ is an equivalence. Now we observe that the square
  \begin{equation*}
    \begin{tikzcd}
      \mathsf{Map}_\ast(\sphere{n+1},D^{n}(A,x)) \arrow[r] \arrow[d] & \mathsf{Map}_\ast(\sphere{n+1},D^{n}(B,f(x))) \arrow[d] \\
      \mathsf{Map}_\ast(\sphere{n+1},(A,x)) \arrow[r] & \mathsf{Map}_\ast(\sphere{n+1},(B,f(x)))
    \end{tikzcd}
  \end{equation*}
  commutes, and has equivalences on both the left and right sides. Moreover, the bottom map is an equivalence by the suspension-loop space adjunction, and the fact that $\mathsf{Map}_\ast(\sphere{n},\loopspace{f,x})$ is an equivalence. We conclude that the top map is an equivalence, which completes the proof.
\end{proof}

\section{Modal descent}

The following theorem can be seen as a `modal flattening lemma'.

\begin{thm}\label{thm:etale_flattening}
Consider a commuting square
\begin{equation*}
\begin{tikzcd}
E' \arrow[d,swap,"{p'}"] \arrow[r,"g"] & E \arrow[d,"p"] \\
B' \arrow[r,swap,"f"] & B
\end{tikzcd}
\end{equation*}
with $H:f\circ p'\htpy p\circ g$, where $E$ and $B$ are modal types. Then the following are equivalent:
\begin{enumerate}
\item The square
  \begin{equation*}
    \begin{tikzcd}
      \modal E' \arrow[r,"\tilde{g}"] \arrow[d,swap,"{\modal p'}"] & E \arrow[d,"p"] \\
      \modal B \arrow[r,swap,"\tilde{f}"] & B
    \end{tikzcd}
  \end{equation*}
  is a pullback square, where $\tilde{f}$ and $\tilde{g}$ are the unique extensions of $f$ and $g$ along the modal units of $B'$ and $E'$, respectively.
\item The square in \cref{thm:etale_flattening} is a pullback square.
\end{enumerate}
\end{thm}

\begin{proof}
  The forward direction is immediate by the pasting lemma for pullbacks, since we have the rectangle
  \begin{equation*}
    \begin{tikzcd}
      E' \arrow[r] \arrow[d] & \modal E' \arrow[r] \arrow[d] & E \arrow[d] \\
      B' \arrow[r] & \modal B' \arrow[r] & B
    \end{tikzcd}
  \end{equation*}
  of commuting squares.
For the converse, consider the diagram
\begin{equation*}
\begin{tikzcd}
E' \arrow[r,"{\mathsf{gap}(p',g,H)}"] \arrow[d,swap,"{p'}"] &[2.5em] \modal B'\times_{B} E \arrow[r,"\proj 2"] \arrow[d,swap,"\proj 1"] & E \arrow[d,"p"] \\
B' \arrow[r,swap,"\modalunit"] & \modal B' \arrow[r,swap,"\tilde{f}"] & B
\end{tikzcd}
\end{equation*}
In this diagram, the square on the right is a pullback by definition, and the outer rectangle is a pullback by assumption, so the square on the left is also a pullback. Therefore the gap map $E'\to \modal B'\times_B E$ is $\modal$-connected. Moreover, since the modal types are closed under pullbacks it follows that $\modal B'\times_B E$ is modal, and therefore it follows that $\proj 2:\modal B'\times_B E\to E$ is a modal map. Therefore the composite
\begin{equation*}
\begin{tikzcd}
E' \arrow[r,"{\mathsf{gap}(p',g,H)}"] &[2.5em] \modal B'\times_{B} E \arrow[r,"\proj 2"] & E 
\end{tikzcd}
\end{equation*}
factors $g$ as a $\modal$-connected map followed by a $\modal$-modal map. Of course, another such factorization is the composite $g\htpy \tilde{g}\circ\modalunit$. Since factorizations are unique, the claim follows.
\end{proof}

Using modal flattening we establish partial left exactness of the modality.

\begin{cor}\label{cor:etale_lex}
Consider a pullback square
\begin{equation*}
\begin{tikzcd}
A' \arrow[d,swap,"{f'}"] \arrow[r] & A \arrow[d,"f"] \\
B' \arrow[r] & B,
\end{tikzcd}
\end{equation*}
where $f$ is assumed to be $\modal$-\'etale. Then the square
\begin{equation*}
\begin{tikzcd}
\modal A' \arrow[d,swap,"{\modal f'}"] \arrow[r] & \modal A \arrow[d,"\modal f"] \\
\modal B' \arrow[r] & \modal B,
\end{tikzcd}
\end{equation*}
is again a pullback square.
\end{cor}

\begin{proof}
Since $f$ is assumed to be $\modal$-\'etale, the square on the right in the diagram
\begin{equation*}
\begin{tikzcd}
A' \arrow[r] \arrow[d,swap,"{f'}"] & A \arrow[r] \arrow[d,swap,"f"] & \modal A \arrow[d,"\modal f"] \\
B' \arrow[r] & B \arrow[r] & \modal B
\end{tikzcd}
\end{equation*}
is a pullback square. Therefore the outer rectangle is a pullback square by the pullback pasting lemma. Now the claim follows from modal flattening \cref{thm:etale_flattening}, using the outer rectangle.
\end{proof}

\begin{cor}\label{cor:etale_pb}
Consider a pullback square
\begin{equation*}
\begin{tikzcd}
E' \arrow[d,swap,"{p'}"] \arrow[r,"g"] & E \arrow[d,"p"] \\
B' \arrow[r,swap,"f"] & B
\end{tikzcd}
\end{equation*} 
and suppose that $p:E\to B$ is $\modal$-\'etale. Then $p':E'\to B'$ is $\modal$-\'etale.
\end{cor}

\begin{proof}
Consider the commuting cube
\begin{equation*}
\begin{tikzcd}
&[-.5ex] E' \arrow[dr] \arrow[d] \arrow[dl] \\
\modal E' \arrow[d] & B' \arrow[dl] \arrow[dr] & E \arrow[dl,crossing over] \arrow[d] \\
\modal B' \arrow[dr] & \modal E \arrow[d] \arrow[from=ul,crossing over] & B \arrow[dl] \\
& \modal B.
\end{tikzcd}
\end{equation*}
The vertical squares on the back right and front right are pullback squares by assumption.
Then it follows from \cref{cor:etale_lex} that the vertical square on the front left is a pullback square.
Therefore the square on the back left is a pullback square by the pullback pasting property.
\end{proof}

\begin{defn}
Let $X$ be a type. We will define an operation
\begin{equation*}
\etmap:\Big(\sm{A:\UU_\modal}A\to\modal X\Big)\to\Big(\sm{Y:\UU}{g:Y\to X}\isetale(g)\Big)
\end{equation*}
\end{defn}

\begin{constr}
Given a map $f:A\to \modal X$ we take the pullback
\begin{equation*}
\begin{tikzcd}
X\times_{\modal X}A \arrow[d,swap,"\proj 1"] \arrow[r,"\proj 2"] & A \arrow[d,"f"] \\
X \arrow[r,swap,"\modalunit"] & \modal X.
\end{tikzcd}
\end{equation*}
Then the map $\proj 1:X\times_{\modal X}A\to X$ is $\modal$-\'etale by \cref{lem:etale_modal,cor:etale_pb}.
\end{constr}

The following is a descent theorem for $\modal$-\'etale maps.

\begin{thm}[Modal descent]\label{thm:modal_descent}
For any modality $\modal$, and any type $X$, the operation
\begin{equation*}
\etmap:\Big(\sm{A:\UU_\modal}A\to\modal X\Big)\to\Big(\sm{Y:\UU}{g:Y\to X}\isetale(g)\Big)
\end{equation*}
is an equivalence.
\end{thm}

\begin{proof}
If $g:Y\to X$ is $\modal$-\'etale, then the square
\begin{equation*}
\begin{tikzcd}
Y \arrow[d,swap,"g"] \arrow[r,"\modalunit"] & \modal Y \arrow[d,"\modal g"] \\
X \arrow[r,swap,"\modalunit"] & \modal X
\end{tikzcd}
\end{equation*}
is a pullback square. Therefore $g:Y\to X$ is in the fiber of $\etmap$ at $\modal g : \modal Y\to\modal X$. 

It remains to show that for any map $f:A\to\modal X$ with modal domain, there is an equivalence $\eqv{A}{\modal (X\times_{\modal X} A)}$ such that the triangle
\begin{equation*}
\begin{tikzcd}[column sep=0]
A \arrow[dr,swap,"f"] \arrow[rr,"\eqvsym"] & & \modal (X\times_{\modal X} A) \arrow[dl,"\modal(\etmap(f))"] \\
\phantom{\modal (X\times_{\modal X} A)} & \modal X
\end{tikzcd}
\end{equation*}
commutes. To see this, note that both $f\circ \proj 2$ and $\modal(\etmap(f))\circ \modalunit$ factor the same map as a $\modal$-connected map followed by a modal map, so the claim follows from uniqueness of factorizations.
\end{proof}

\begin{cor}
Suppose $P:X\to\UU_\modal$ is a family of modal types such that the projection map $\proj 1:\big(\sm{x:X}P(x)\big)\to X$ is $\modal$-\'etale. Then $P$ has a unique extension
\begin{equation*}
\begin{tikzcd}
X \arrow[d,swap,"\modalunit"] \arrow[r,"P"] & \UU_\modal. \\
\modal X \arrow[ur,densely dotted,swap,"\tilde{P}"] 
\end{tikzcd}
\end{equation*}
It follows that the commuting square
\begin{equation*}
\begin{tikzcd}
\sm{x:X}P(x) \arrow[d,swap,"\proj 1"] \arrow[r] & \sm{t:\modal X}\tilde{P}(t) \arrow[d,"\proj 1"] \\
X \arrow[r,swap,"\modalunit"] & \modal X
\end{tikzcd}
\end{equation*}
is a pullback square. In particular the top map is $\modal$-connected, so this square is in fact a $\modal$-naturality square.
\end{cor}

\section{The reflective factorization system}

In this section we investigate a second factorization system that can be obtained from any modality, of which the right class is the class of $\modal$-\'etale maps. The left class is the class of \emph{$\modal$-equivalences}.

\begin{defn}
We say that a map $f:A\to B$ is an \define{$\modal$-equivalence} if $\modal f:\modal A\to \modal B$ is an equivalence.
\end{defn}

\begin{rmk}
The difference between the notions of $\modal$-equivalences and $\modal$-connected maps is best explained by an example. In the case of $n$-truncation, the $n$-equivalences are precisely the maps that induce isomorphisms on the first $n$ homotopy groups. The $n$-connected maps are the maps that induce isomorphisms on the first $n$ homotopy groups, and moreover induce an epimorphism on the $(n+1)$-st homotopy group. 

We also note that the $n$-equivalences are not stable under pullbacks, whereas the $n$-connected maps are. Consider for instance the pullback square
\begin{equation*}
\begin{tikzcd}
\loopspace {\sphere{n+1}} \arrow[r] \arrow[d] & \unit \arrow[d] \\
\unit\arrow[r] & \sphere{n+1}
\end{tikzcd}
\end{equation*}
Here the map on the right is an $n$-equivalence, since $\sphere{n+1}$ is $n$-connected. However, the map on the left is not an $n$-equivalence, since the $n$-th homotpy group of $\loopspace{\sphere{n+1}}$ is not trivial: it is the $(n+1)$-st homotopy group of $\sphere{n+1}$, which is $\Z$.
\end{rmk}

\begin{defn}
The \define{reflective factorization system} associated to a modality $\modal$ consists of the $\modal$-equivalences as the left class, and the $\modal$-\'etale maps as the right class.
\end{defn}

Our goal in this section is to show that the reflective factorization system associated to a modality is an orthogonal factorization system.

\begin{lem}\label{lem:3for2_mequiv}
The $\modal$-equivalences satisfy the 3-for-2 property: given a commuting triangle
\begin{equation*}
\begin{tikzcd}
A \arrow[rr,"h"] \arrow[dr,swap,"f"] & & B \arrow[dl,"g"] \\
& C,
\end{tikzcd}
\end{equation*}
if any two of $f$, $g$, and $h$ are $\modal$-equivalences, then so is the third.
\end{lem}

\begin{proof}
Apply $\modal$ to the commuting triangle, and use the 3-for-2 property of equivalences.
\end{proof}

\begin{lem}\label{lem:modal_equivalence}
For a map $f : A \to B$ the following are equivalent:
\begin{enumerate}
\item $f$ is an $\modal$-equivalence.
\item For any modal type $X$, the precomposition map
\begin{equation*}
\precomp{f} : (B \to X) \to (A \to X)
\end{equation*}
is an equivalence.
\end{enumerate}
\end{lem}

\begin{proof} 
Suppose first that $f$ is an $\modal$-equivalence, and let $X$ be $\modal$-modal. Then the square
\begin{equation*}
\begin{tikzcd}
X^B \arrow[r,"\precomp{f}"] \arrow[d,swap,"\precomp{\eta}"] & X^A \arrow[d,"\precomp{\eta}"] \\
X^{\modal B} \arrow[r,swap,"\precomp{\modal f}"] & X^{\modal A}
\end{tikzcd}
\end{equation*}
commutes. In this square the two vertical maps are equivalences by the universal property of modalization, and the bottom map is an equivalence since $\modal f$ is an equivalence. Therefore the map $\precomp{f}:X^B\to X^A$ is an equivalence, as desired.

Conversely, assume that $\precomp{f} : X^B \to X^A$ is an equivalence for every $\modal$-modal type $X$. By the square above it follows that $\precomp{\modal f}:X^{\modal B}\to X^{\modal A}$ is an equivalence for every $\modal$-modal type $X$. The fiber of $\modal A^{\modal B}\to \modal A^{\modal A}$ at $\idfunc:\modal A\to \modal A$ is contractible, so we obtain a retraction $g$ of $\modal f$. To see that $g$ is also a section observe that the fiber of $\modal B^{\modal B}\to \modal B^{\modal A}$ at $\modal f$ is contractible. This fiber contains $(\idfunc[\modal B],\refl{\modal f})$. However, we also have an identification $p:\precomp{\modal f}(\modal f\circ g)=\modal f$, since
\begin{equation*}
\precomp{\modal f}(\modal f\circ g)\jdeq (\modal f \circ g)\circ \modal f\jdeq \modal f \circ (g\circ \modal f) = \modal f. 
\end{equation*}
Therefore $(\modal f\circ g,p)$ is in the fiber of $\precomp{\modal f}:\modal B^{\modal B}\to \modal B^{\modal A}$ at $\modal f$. By the contractibility of the fibers it follows that $(\modal f\circ g,p)=(\idfunc[\modal B],\refl{\modal f})$, so it follows that $\modal f\circ g=\idfunc[\modal B]$. In other words, $g$ is both a retraction and a section of $\modal f$, so $\modal f$ is an equivalence.
\end{proof}

\begin{cor}\label{cor:mequiv_mconn}
Every $\modal$-connected map is a $\modal$-equivalence.
\end{cor}

\begin{lem}\label{lem:rfs_factor}
Every map factors as a $\modal$-equivalence followed by a $\modal$-\'etale map.
\end{lem}

\begin{proof}
Consider a map $f:A\to B$, and the diagram
\begin{equation*}
\begin{tikzcd}
A \arrow[ddr,bend right=15,swap,"f"] \arrow[drr,bend left=15,"\modalunit"] \arrow[dr,"\mathsf{gap}" description] \\
& B\times_{\modal B} \modal A \arrow[d,swap,"\proj 1"] \arrow[r,"\proj 2"] & \modal A \arrow[d,"\modal f"] \\
& B \arrow[r,swap,"\modalunit"] & \modal B.
\end{tikzcd}
\end{equation*}
Then $\proj 1:B\times_{\modal B} \modal A\to B$ is a pullback of a map between modal types, so it is $\modal$-\'etale by \cref{cor:etale_pb}. Furthermore, the map $\proj 2:B\times_{\modal B}\modal A\to \modal A$ is a pullback of a $\modal$-connected map, so it is $\modal$-connected. It follows from \cref{cor:mequiv_mconn} that it is a $\modal$-equivalence. Since the modal unit $\modalunit :A\to\modal A$ is also $\modal$-connected, and therefore a $\modal$-equivalence, we obtain by the 3-for-2 property of $\modal$-equivalences established in \cref{lem:3for2_mequiv} that the gap map is also a $\modal$-equivalence.
\end{proof}

We use the notion of orthogonal factorization systems of \cite{RijkeSpittersShulman}.

\begin{thm}\label{thm:rfs_orthogonal}
  The pair $(\mathcal{L},\mathcal{R})$, where $\mathcal{L}$ is the class of $\modal$-equivalences, and $\mathcal{R}$ is the class of $\modal$-\'etale maps, is an orthogonal factorization system.
\end{thm}

\begin{proof}
  We have already shown that every map factors as a left map followed by a right map. Therefore it suffices to show that the class of $\modal$-equivalences is left orthogonal to the class of $\modal$-\'etale maps.
  
We have to show that for every $\modal$-equivalence $i:A\to B$, and every $\modal$-\'etale map $f:X\to Y$, the square
\begin{equation*}
\begin{tikzcd}
X^B \arrow[r] \arrow[d] & Y^B \arrow[d] \\
X^A \arrow[r] & Y^A
\end{tikzcd}
\end{equation*}
is a pullback square. Consider the commuting cube
\begin{equation*}
\begin{tikzcd}
&[-1ex] X^B \arrow[dl] \arrow[d] \arrow[dr] \\
(\modal X)^B \arrow[d] & X^A \arrow[dl] \arrow[dr] & Y^B \arrow[d] \arrow[dl,crossing over] \\
(\modal X)^A \arrow[dr] & (\modal Y)^B \arrow[from=ul,crossing over] \arrow[d] & Y^A \arrow[dl] \\
& (\modal Y)^A
\end{tikzcd}
\end{equation*}
In this cube the top and bottom squares are pullback by the assumption that $f$ is $\modal$-\'etale and the fact that exponents of pullback squares are again pullback squares. Furthermore, the square in the front left is pullback, because the two vertical maps are equivalences by the assumption that $i:A\to B$ is a $\modal$-equivalence. Therefore we conclude that the square in the back right is also a pullback square, as desired.
\end{proof}

\section{Conjectural Applications in Geometry}

So far, we discussed the $n$-truncations as an example from plain Homotopy Type Theory.
\emph{Viewing} Homotopy Type Theory as an internal language of $(\infty,1)$-toposes,
which is crucial for the following,
special features of a particular topos may be introduced into the type theory as modalities.

We speak of ``conjectural'' application in this section because we will neither describe how the toposes and modalities are constructed nor how the type theoretic results in this article can be applied to those toposes.
However, what is presented in the following could be seen as an application in the sense that an \emph{internal} theory of algebraic or topological spaces can be advanced with our results.
Another goal of this section, which is probably the most important, is to make the readers aware of the examples from geometry we had in mind when discovering the modal descent theorem \ref{thm:modal_descent} and lemma \ref{lem:etale_char}.

The following table is an overview of the applications that will be discussed in this section.
Details on the topos ``$\Spaces$'' can be found under ``\ref{subsection:toplogical stacks} Topology'' below the other toposes and modalities are under ``\ref{subsection:algebraic and differential geometry} Algebraic and Differential Geometry''.
\begin{center}
  \begin{tabular}{p{3.5cm}p{8.5cm}}
    \toprule
    $\modal$ & $\modal$-étale maps  \\
    \midrule
    $\trunc{n}{\_}$ on $\infty$-groupoids & For $n\geq -1$: maps right orthogonal to $1\to S^{n+1}$ by \cref{thm:rfs_orthogonal}. \\
    $\trunc{1}{\_}\circ\shape$ on $\Spaces$ & Some notion of covering space for topological stacks \\
    $\trunc{n}{\_}\circ\shape$ on $\Spaces$ & Generalization of covering space for topological stacks, where the universal cover is a topological stack with an $n$-connected homotopy type \\
    $\shape$ on $\Spaces$ & Generalization of covering spaces, where the universal cover is a stack with trivial homotopy type \\
    $\sharp$ on $\Spaces$ & Maps where the domain carries the induced topology \\
    $\Im$ on $\mathrm{Sh}(k\mathrm{-Alg}^\mathrm{op} ,\Zar)$ & Formally étale maps in the sense of \cite{GrothendieckDieudonne}, if domain and codomain are noetherian $k$-schemes   \\
    $\Im$ on $\FSGrp$ & Local diffeomorphisms, if domain and codomain are manifolds \\
    \bottomrule
  \end{tabular}
\end{center}

\bigskip

\subsection{Topology}
\label{subsection:toplogical stacks}

In \cite[Section 8]{ShulmanRealCohesion} Mike Shulman introduces real-cohesive homotopy type theory
\footnote{In 8.1 of Shulman's paper, ``real-cohesive'' is used, if the axiom ``$\mathrm{R}\flat$'' is assumed, which we will assume here as well.}.
This type theory is a candidate for an internal language for some quite specific \emph{cohesive} ($\infty$,1)-toposes.
The term ``cohesion'' refers to a higher analog 
of Lawvere's axiomatic cohesion \cite{Lawvere07} developed by Urs Schreiber \cite{SchreiberDcct}.

Let us look at an example of such a topos, which contains some \emph{topological stacks}.
The objects may have both topological \emph{and} homotopical structure, which are not the same.
As a site, we can use the full subcategory of topological spaces spanned by
\[ \{ \bR^n \vert n\in\bN\}\]
with a topology given by covering collections of open subsets with contractible intersections.
We will call the topos of sheaves on this site with values in $\infty$-groupoids $\Spaces$. 
Theorem \ref{thm:modal_descent} will turn out to tell us in this context,
that important parts of the theory of covering spaces of topological spaces hold for a general abstract modality.
One modality of interest for application of our theory of $\modal$-étale maps is based on the functor mapping a stack to its fundamental $\infty$-groupoid,
which is an endofunctor if $\infty$-groupoids are identified with constant stacks. This modality is denoted $\shape$ in Shulman's article.

In Real Cohesive Homotopy Type Theory\footnote{As given in \cite{ShulmanRealCohesion}.},
which will just be called Real Cohesion in the following, 
some well behaved topological spaces, like, for example, topological manifolds
are supposed to be included in the theory as they are included in the category $\Spaces$ defined above.
It is important to note, that the types corresponding to these topological spaces
are 0-types in Real Cohesion.

This can lead to confusion with the common explanation for the identity types in Homotopy Type Theory,
as paths in a space, since that would give us \emph{two different} notion of path. 
On the one hand, there are topological paths, i.e. maps $\gamma:\bR\to X$ from the 0-type $\bR$ representing the real line with the euclidean topology.
And in the common Homotopy Type Theory terminology, the elements of identity types $x=_A y$ in some type $A$ are also called path but are very different from the topological paths. To avoid confusion, we will follow Mike Shulman's terminology from \cite{ShulmanRealCohesion} and refer to topological paths as paths and to elements of identity types as equalities in the following.

Let $\bS^{n}$ denote the topological sphere given by
\[ \bS^{n}:\equiv\left\{ (x_1,\dots,x_{n+1})\in\bR^{n+1}\left\vert \sum_{i=1}^{n+1}x_i^2=1\right.\right\}\]
and $\sphere{n}$ the higher inductive type introduced in \cite{UFP}, which we already used freely throughout the article.
The Reals ``$\bR$'' in this definition are, as in \cite{ShulmanRealCohesion}, the \emph{Dedekind Reals},
which are known to coincide with the external sheaf $\mathrm{Hom}_{\mathrm{Top}}(\_,\bR)$ in $\Spaces$ and some similar toposes.

For the present work, the shape modality ``$\shape$'' from Real Cohesion is of special interest.
It maps topological spaces to their \emph{homotopy type}, so for example $\shape \bS^{1} =\sphere{1}$ 
and $\shape \bR =1$.


In a 1-topos cohesive over Set, the functor $\Delta\circ\pi_0$ maps a sheaf to the sheaf constantly its set of connected components.
The $\shape$ is a higher analog of this functor that extracts homotopical information on all h-levels, not just level 0.
So if $X$ represents a topological space with a point $\ast: X$, 
then $\shape X$ is also pointed and the n-th homotopy group of $X$ as a topological space 
could be retrieved from its shape 
as $\pi_n(X):\equiv\trunc{0}{\Omega^n(\shape X)}$.

Like $\Delta\circ\pi_0$ reflects into the subcategory of constant sheaves, $\shape$ reflects into the \emph{discrete} types.
Note that ``discrete'' refers to the topological structure of a type, 
not to a property of the $\infty$-groupoid structure given by its identity type.

The equation ``$\shape \bR=1$'' may be viewed as one of the defining properties of $\shape$
-- it can be defined as the modality \emph{nullifiying} $\bR$ (see \cite[Section 2.3]{RijkeSpittersShulman} for details on nullification modalities).

As all modalities, $\shape$ comes with a unit-map $\modalunit_X\colon X \to \shape X$, for any type $X$.
For any two points $x,y: X$ that are joined by a topological path, 
the images $\modalunit_X(x)$ and $\modalunit_X(y)$ are equal in $\shape X$.

For $\bS^{1}$, this fiber or $\shape$-disk
\[ \sum_{x:\bS^{1}}\modalunit_{\bS^{1}}(x)=\modalunit(\ast) \]
turns out to be the universal cover of $\bS^{1}$.
But this works only for spaces with trivial higher homotopy groups. 
For the construction of the universal cover of an arbitrary type, this has to be adjusted:
\[ \widetilde{X}:\equiv \sum_{x\colon X} \trunc{0}{\modalunit_X(x)=\ast}. \]
Note that this type would again be a fiber of a unit, if we had a modality that takes the shape and 1-truncates it.
It is not clear to us, if the simple definition $\shape_1:\equiv\trunc{1}{\_}\circ\shape$ works.
One way to make it work, would be to show that truncations of discrete types are again discrete types.
But it is not known by the authors if this is true and it seems to be an open problem
\footnote{We have to thank one of our anonymous reviewers for pointing out the problem with the simple definition and the solution we use below.}.
In \cite[Theorem 3.28]{RijkeSpittersShulman} it is shown that for any two accessible modalities,
there is a modality such that its modal types are the meet of the modal types of the two modalities.
So we can make the following definition:
\begin{defn}
Let the 1-shape, $\shape_1$ be the modality given as the meet of the accessible modalities $\trunc{1}{\_}$ and $\shape$ with $\shape_1$.
\end{defn}
Then, also from \cite{RijkeSpittersShulman} we know, that a type is $\shape_1$-modal if and only if it is discrete and 1-truncated.
In \cite[Theorem 6.21]{ShulmanRealCohesion} it is shown that crisply discrete types have discrete $n$-truncations.
So for crisp types $X$, we have
\[ \trunc{1}{\shape X} \simeq \shape_1 X\text{.} \]

With $\shape_1$ and its unit $\eta$, covering spaces and the universal cover are easy to define:
\begin{defn}
  \begin{enumerate}
  \item A map $f:X\to Y$ is called a \emph{covering space}, if it is $\shape_1$-étale and $0$-truncated.
  \item Let $X$ be a pointed type. Then
    \[ \widetilde{X}:\equiv D^{\shape_1}(X,\ast)\equiv\sum_{x:X}\modalunit(x)=\modalunit(\ast) \]
    is the \emph{universal cover} of $X$.
  \end{enumerate}

\end{defn}
The following basic observations give some justification to those names:
\begin{rmk}
  Let $X$ be any pointed type.
  \begin{enumerate}
  \item The projection from the universal cover $\widetilde{X}$ is a covering space.
  \item We have $\shape_1 \widetilde{X} = 1$.
  \item Let $f:Y\to X$ be a covering space. Then we have the following lifting property:
    A map $g:Z\to X$ lifts uniquely to $Y$, if $\shape_1 g$ lifts to $\shape_1 Y$ along $\shape_1 f$.
  \item Let $f:Y\to X$ be a covering space and a pointed map. Then there is a unique map $\widetilde{X}\to Y$ over $X$.
  \end{enumerate}
\end{rmk}
\begin{proof}
  \begin{enumerate}
  \item By lemma \ref{cor:etale_pb}. 
  \item Applying \ref{thm:modal_descent} to $1\to \shape_1 X$ yields this result directly.
  \item This is the universal property of the pullback square from the definition of $\modal$-étale maps.
  \item This is an application of (iii).
  \end{enumerate}
\end{proof}

The construction of the covering spaces corresponding to a subgroup $H\subseteq \pi_1(X)$ for a path connected $X$,
can be done by applying the delooping construction of \cite{LicataFinster} to the inclusion map of $H$ to get a map $Bi:BH\to\shape_1(X)$ and pulling $Bi$ back along $\modalunit$. In other words, we use that any subgroup $H\subseteq\pi_1(X)$ can be represented by an action of $\pi_1(X)$ on a discrete 0-type
\footnote{This means we use the \emph{homotopical} covering theory of \cite[Section 3.1]{favonia-thesis} 
and \cite[Section 7.1]{ulrik-egbert-floris-groups}}
and therefore a map $BH\to \shape_1X$, with discrete $BH$.

To get the full correspondence for some general type $X$ of actions of the fundamental groupoid of $X$ on sets and covering spaces over $X$,
we can apply theorem \ref{thm:modal_descent} to $\shape_1$ to get:

\begin{thm}
  \begin{enumerate}
  \item Let $X$ be a type. Then the type of $\shape_1$-étale maps into $X$ and the type of $\shape_1$-modal dependent types over $\shape_1 X$ are equivalent.
  \item In particular the type of covering spaces and the type of maps $\shape_1X\to \mathcal U_{\shape_0}$ are equivalent.
    If $X$ is pointed and $\shape_1 X$ connected, $\shape_1X\to \mathcal U_{\shape_0}$ is the type of actions of the fundamental group $\Omega(\shape_1 X)$ on discrete 0-types.
  \end{enumerate}
\end{thm}
\begin{proof}
  \begin{enumerate}
  \item This is just lemma \ref{thm:modal_descent} applied to $\shape_1$.
  \item By pullback pasting and surjectivity of $\modalunit_X$, fibers of 1-covering spaces over $X$ are always equivalent to values of the corresponding morphism $\shape_1 X\to \mathcal U_{\shape_1}$ and vice versa.
  \end{enumerate}
\end{proof}

Similar generalizations of the classical topological correspondence are known on the classical side
for example for cohesive $\infty$-stacks \cite[Section 5.2.7]{SchreiberDcct} or \cite{dmr-2covers}.
The introduction of the latter also gives more details on the history of the subject,
in particular concerning definitions of covering spaces topological and differentiable stacks.
The authors see an advantage of their approach in the clarity of the type theoretic proofs.

\subsection{Algebraic and Differential Geometry}
\label{subsection:algebraic and differential geometry}
\todo{make section coherent again..}
A topos for differentiable stacks can be built from a site with the same objects as $\Spaces$ but only smooth maps as morphisms.
It turns out that we have even more interesting modalities, if we extend the site by \emph{infinitesimal disks} to arrive at the topos of
formally smooth $\infty$-groupoids $\FSGrp$ as defined in \cite[Definition 2.11]{SyntheticPDEs} which we will explain briefly now.

For the following it is important to note that the functor $\mathcal C^\infty$ sending a smooth manifold, in our case $\bR^n$ to its $\bR$-algebra of smooth functions is fully faithful.
The site $S$ of $\FSGrp$ has objects we call $\bR^n\times\bD_A$ for any $n\in\bN$ and any finitely generated $\bR$-algebra $A$,
such that any $x\in A$ with $x\notin\bR$ is nilpotent.
The morphisms $f:\bR^n\times\bD_A\to \bR^k\times\bD_B$ in $S$ are given as opposites of the $\bR$-algebra homomorphisms
\[ \mathcal C^\infty(\bR^k)\otimes_\bR B \to \mathcal C^\infty(\bR^n)\otimes_\bR A\text{.} \]
The topology is essentially given by good open covers of open immersions\footnote{See \cite[Definition 2.11]{SyntheticPDEs} for details.}.

The $\modal$-étale maps for a special modality $\Im$ were already discussed in \cite{wellen-thesis} and \cite{wellen-cartan-geometry}.
One basic topos where a corresponding functor can be defined is given as $\infty$-groupoid valued sheaves on the site $k\mathrm{-Alg}^{\mathrm{op}}_{\mathrm{fp}}$ of finitely presented affine schemes over a field $k$ with the Zariski topology. Here, for any $X\in\mathrm{Sh}(k\mathrm{-Alg}^\mathrm{op}_{\mathrm{fp}})$ ,
the functor $\Im X$ defined pointwise by
\[ (\Im X)(A):\equiv X(A/\sqrt{0})\]
turns out to be a sheaf again. So $\Im$ is an endofunctor on the sheaf-topos which turns out to be well behaved enough to generate a modality\todo{reference}.

The name $\modal$-étale is an adaption of the name ``formally étale'' for general modalities.
The more specific name was used in \cite{wellen-thesis}, which reused the name from \cite{SyntheticPDEs}.
The original definition of formally étale maps is from algebraic geometry (see \cite[§ 17]{GrothendieckDieudonne}).
\begin{defn}
  A morphisms of schemes $\varphi:X\to Y$ is \emph{formally étale},
  if for all rings $R$ and all nilpotent ideals $N$ in $R$ all squares
  \begin{center}
    \begin{tikzcd}
      \mathrm{Spec(R/N)}\arrow[r]\arrow[d] & X\arrow[d, "f"] \\
      \mathrm{Spec(R)}\arrow[r]\arrow[ru, dashed, "\exists!"] & Y
    \end{tikzcd}
  \end{center}
  have a unique lift like indicated in the diagram.
\end{defn}
We will now make a remark which explains how the formally étale maps from algebraic geometry relate to our notion of $\modal$-étale.
The proof is mostly a repetition of a proof from \cite[Section 4.4]{wellen-thesis}.
We use the fact, that the noetherian schemes are also sheaves in the Zariski Topos and that we have the functor $\Im$ like above.
\begin{rmk}
  A morphism of $f:X\to Y$ noetherian schemes $X,Y$ is formally étale if and only if the naturality square
  \begin{center}
    \begin{tikzcd}
      X\arrow[r]\arrow[d, "f", swap] & \Im X\arrow[d, "\Im f"] \\
      Y\arrow[r] & \Im Y
    \end{tikzcd}
  \end{center}
  is a pullback square.
\end{rmk}
\begin{proof}
  Let $X$ and $Y$ be noetherian schemes\footnote{These means they are covered by $\mathrm{Spec}$s of finitely generated algebras.}. 
  We will first show that a morphism of schemes $f:X\to Y$ is formally étale,
  if and only if for all noetherian rings $R$ all squares
  \begin{center}
    \begin{tikzcd}
      \mathrm{Spec(R/\sqrt{0})}\arrow[r]\arrow[d] & X\arrow[d, "f"] \\
      \mathrm{Spec(R)}\arrow[r]\arrow[ru, dashed, "\exists!"] & Y
    \end{tikzcd}
  \end{center}
  have a unique lift like indicated in the diagram. Let us call this property (1).
  Since $\sqrt{0}$ is always nilpotent in a noetherian ring, (1) is implied if $f$ is formally étale.
  
  The property formally étale is known to be local in the source (\todo{reference}), so we can assume $X$ and $Y$ to be affine.
  For affine $X=\mathrm{Spec(S)}$ and $Y=\mathrm{Spec(S)}$, all squares
  \begin{center}
    \begin{tikzcd}
      \mathrm{Spec(R/N)}\arrow[r]\arrow[d] & X\arrow[d, "f"] \\
      \mathrm{Spec(R)}\arrow[r, "\mathrm{Spec}(\varphi)"] & Y
    \end{tikzcd}
  \end{center}
  factor as 
  \begin{center}
    \begin{tikzcd}
      \mathrm{Spec(R/N)}\arrow[r]\arrow[d] & \mathrm{Spec}(\mathrm{im}(\varphi)/(\mathrm{im}(\varphi)\cap N))\arrow[r]\arrow[d] & X\arrow[d, "f"] \\
      \mathrm{Spec(R)}\arrow[r] & \mathrm{Spec}(\mathrm{im}(\varphi))\arrow[r] & Y
    \end{tikzcd}
  \end{center}
  That means we can assume $R$ to be noetherian, if $X$ and $Y$ are noetherian for the sake of checking if $f$ is formally étale.
  So let us assume (1) holds. Let $R$ be noetherian and let us construct a unique lift in
  \begin{center}
    \begin{tikzcd}
      \mathrm{Spec(R/N)}\arrow[r]\arrow[d] & X\arrow[d, "f"] \\
      \mathrm{Spec(R)}\arrow[r] & Y
    \end{tikzcd}
  \end{center}
  We extend the square by reducing $R$ or equivalently $R/N$:
  \begin{center}
    \begin{tikzcd}
      \mathrm{Spec}(R/\sqrt{0})\arrow[rd]\arrow[d] & \\
      \mathrm{Spec(R/N)}\arrow[r]\arrow[d] & X\arrow[d, "f"] \\
      \mathrm{Spec(R)}\arrow[r] & Y
    \end{tikzcd}
  \end{center}
  There are two ways to view the boundary of this diagram as a square, so we can apply (1) in two different ways.
  One application tells us, that the map $\mathrm{Spec}(R/N)\to X$ is the unique one making the diagram commute.
  The second application yields a unique lift:
  \begin{center}
    \begin{tikzcd}
      \mathrm{Spec}(R/\sqrt{0})\arrow[rd]\arrow[d] & \\
      \mathrm{Spec(R/N)}\arrow[d] & X\arrow[d, "f"] \\
      \mathrm{Spec(R)}\arrow[r]\arrow[ur, dashed] & Y
    \end{tikzcd}
  \end{center}
  which is also a lift in the original square by the uniqueness of the map $\mathrm{Spec}(R/N)\to X$.
  This proves that (1) implies that $f$ is formally étale.

  So what remains to be shown is that (1) is equivalent to 
  \begin{center}
    \begin{tikzcd}
      X\arrow[r]\arrow[d, "f", swap] & \Im X\arrow[d, "\Im f"] \\
      Y\arrow[r] & \Im Y
    \end{tikzcd}
  \end{center}
  being a pullback. This is true if and only if it is true pointwise, i.e. for all rings $R$,
  the squares 
  \begin{center}
    \begin{tikzcd}
      X(R)\arrow[r]\arrow[d, "f_R", swap] & \Im X(R)\arrow[d, "\Im f_R"] & = X(R/\sqrt{0}) \\
      Y(R)\arrow[r] & \Im Y(R) & = Y(R/\sqrt{0})
    \end{tikzcd}
  \end{center}
  have to be pullback squares. But this is just (1) by Yoneda.
\end{proof}

Let us look at the characterization of $\Im$-étale maps from lemma \ref{lem:etale_char}.
For a map $f:X\to Y$, the assumption that $\eta_X$ is surjective corresponds to a generalization of formal smoothness of $X$.
The latter is discussed in \cite[Section 4.4]{wellen-thesis}, where the author forgot to take the difference between pointwise surjections and epimorphisms of sheaves into account.
If we assume this holds for $X$, the lemma tells us that $f$ is $\Im$-étale, if and only if, the following is a pullback:
\begin{equation*}
\begin{tikzcd}[column sep=large]
X\times_{\Im X} X \arrow[d,swap,"\pi_1"] \arrow[r,"{f\times_{\Im f} f}"] & Y\times_{\Im Y} Y \arrow[d,"\pi_1"] \\
X \arrow[r,swap,"f"] & Y
\end{tikzcd}
\end{equation*}
In Algebraic Geometry, these pullbacks are called \emph{formal neighborhoods of the diagonal} if $X$ represents a noetherian scheme.
A fiber $\pi_1^{-1}(x)$ is a $\modal$-disk $\bD_x:\equiv D^\Im(X,x)$ around a point $x:X$.
$\modal$-disks can be defined internally for any modality by the pullback
\begin{equation*}
  \begin{tikzcd}
    \bD_x\arrow[r]\arrow[d] & 1\arrow[d, "\eta_X(x)"] \\
    X \arrow[r] & \Im X
  \end{tikzcd}
\end{equation*}
And the condition that the square above is a pullback is precisely the condition that all induced maps
\[ df_x:\bD_x\to\bD_{f(x)}\text{, (so $df_x\equiv D^\Im(f,x)$) }\]
are equivalences. So a translation of lemma \ref{lem:etale_char} into Algebraic Geometry could read
``A map from a formally smooth space, is formally étale, if and only if, it induces an isomorphism on all $\modal$-disks.''.
\todo{say how this can be plugged into real cohesion or done in a similar style}

\section{Conclusion}
\todo{React to suggestions for conclusions and write something about factorization systems.}

\printbibliography

\end{document}
